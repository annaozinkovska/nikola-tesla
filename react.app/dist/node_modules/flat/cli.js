#!/usr/bin/env node


var fs = require('fs');
var path = require('path');
var readline = require('readline');

var flat = require('./index');

var filepath = process.argv.slice(2)[0];
if (filepath) {
  // Read from file
  var file = path.resolve(process.cwd(), filepath);
  fs.accessSync(file, fs.constants.R_OK); // allow to throw if not readable
  out(require(file));
} else if (process.stdin.isTTY) {
  usage(0);
} else {
  // Read from newline-delimited STDIN
  var lines = [];
  readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    terminal: false
  }).on('line', function (line) {
    return lines.push(line);
  }).on('close', function () {
    return out(JSON.parse(lines.join('\n')));
  });
}

function out(data) {
  process.stdout.write(JSON.stringify(flat(data), null, 2));
}

function usage(code) {
  console.log('\nUsage:\n\nflat foo.json\ncat foo.json | flat\n');

  process.exit(code || 0);
}